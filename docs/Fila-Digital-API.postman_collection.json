{
  "info": {
    "name": "Fila Digital API",
    "description": "Cole√ß√£o completa para testar a API do Sistema de Fila Digital",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api/v1",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "tenantId",
      "value": "",
      "type": "string"
    },
    {
      "key": "queueId",
      "value": "",
      "type": "string"
    },
    {
      "key": "ticketId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üè¢ 1. Setup - Criar Empresa",
      "item": [
        {
          "name": "Criar Tenant (Centro Cl√≠nico)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Centro Cl√≠nico S√£o Paulo\",\n  \"slug\": \"centro-clinico-sp\",\n  \"email\": \"contato@centroclinico.com.br\",\n  \"phone\": \"(11) 3333-4444\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants",
              "host": ["{{baseUrl}}"],
              "path": ["tenants"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const tenant = pm.response.json();",
                  "    pm.collectionVariables.set('tenantId', tenant.id);",
                  "    pm.test('Tenant criado com sucesso', function () {",
                  "        pm.expect(tenant.name).to.eql('Centro Cl√≠nico S√£o Paulo');",
                  "    });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Criar Admin da Empresa",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Dr. Jo√£o Silva\",\n  \"email\": \"joao.silva@centroclinico.com.br\",\n  \"password\": \"senha123456\",\n  \"role\": \"ADMIN\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/agents",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "agents"]
            }
          }
        }
      ]
    },
    {
      "name": "üîê 2. Autentica√ß√£o",
      "item": [
        {
          "name": "Login Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"joao.silva@centroclinico.com.br\",\n  \"password\": \"senha123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const auth = pm.response.json();",
                  "    pm.collectionVariables.set('authToken', auth.access_token);",
                  "    pm.test('Login realizado com sucesso', function () {",
                  "        pm.expect(auth.access_token).to.be.a('string');",
                  "        pm.expect(auth.user.role).to.eql('ADMIN');",
                  "    });",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üéØ 3. Criar Filas",
      "item": [
        {
          "name": "Criar Fila - Endocrinologia",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Endocrinologia\",\n  \"description\": \"Consultas com endocrinologista - Dr. Maria Santos\",\n  \"queueType\": \"GENERAL\",\n  \"capacity\": 20,\n  \"avgServiceTime\": 900\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const queue = pm.response.json();",
                  "    pm.collectionVariables.set('queueId', queue.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Criar Fila - Pediatria",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Pediatria\",\n  \"description\": \"Consultas pedi√°tricas - Dra. Ana Costa\",\n  \"queueType\": \"PRIORITY\",\n  \"capacity\": 25,\n  \"avgServiceTime\": 1200\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          }
        },
        {
          "name": "Criar Fila - Raio-X",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Raio-X\",\n  \"description\": \"Exames de radiografia\",\n  \"queueType\": \"GENERAL\",\n  \"capacity\": 15,\n  \"avgServiceTime\": 300\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          }
        },
        {
          "name": "Criar Fila - Oftalmologia",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Oftalmologia\",\n  \"description\": \"Consultas oftalmol√≥gicas - Dr. Carlos Lima\",\n  \"queueType\": \"GENERAL\",\n  \"capacity\": 12,\n  \"avgServiceTime\": 600\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          }
        }
      ]
    },
    {
      "name": "üìã 4. Listar Filas",
      "item": [
        {
          "name": "Listar Todas as Filas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          }
        },
        {
          "name": "Buscar Fila Espec√≠fica",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues/{{queueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues", "{{queueId}}"]
            }
          }
        },
        {
          "name": "üëë Dashboard - TODOS os Clientes em TODAS as Filas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues/all-tickets",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues", "all-tickets"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const data = pm.response.json();",
                  "    ",
                  "    pm.test('Resposta possui summary e queues', function () {",
                  "        pm.expect(data).to.have.property('summary');",
                  "        pm.expect(data).to.have.property('queues');",
                  "        pm.expect(data.queues).to.be.an('array');",
                  "    });",
                  "    ",
                  "    pm.test('Summary possui estat√≠sticas consolidadas', function () {",
                  "        pm.expect(data.summary).to.have.property('totalQueues');",
                  "        pm.expect(data.summary).to.have.property('totalWaiting');",
                  "        pm.expect(data.summary).to.have.property('totalCalled');",
                  "        pm.expect(data.summary).to.have.property('avgWaitTime');",
                  "        pm.expect(data.summary).to.have.property('lastUpdated');",
                  "    });",
                  "    ",
                  "    if (data.queues.length > 0) {",
                  "        pm.test('Filas possuem informa√ß√µes completas', function () {",
                  "            const queue = data.queues[0];",
                  "            pm.expect(queue).to.have.property('id');",
                  "            pm.expect(queue).to.have.property('name');",
                  "            pm.expect(queue).to.have.property('currentNumber');",
                  "            pm.expect(queue).to.have.property('totalWaiting');",
                  "            pm.expect(queue).to.have.property('tickets');",
                  "        });",
                  "    }",
                  "    ",
                  "    console.log('üìä Estat√≠sticas Consolidadas:');",
                  "    console.log(`üè¢ Total de Filas: ${data.summary.totalQueues}`);",
                  "    console.log(`‚è≥ Aguardando: ${data.summary.totalWaiting}`);",
                  "    console.log(`üìû Chamados: ${data.summary.totalCalled}`);",
                  "    console.log(`‚úÖ Completados: ${data.summary.totalCompleted}`);",
                  "    console.log(`‚è±Ô∏è Tempo M√©dio: ${data.summary.avgWaitTime}s`);",
                  "    ",
                  "    data.queues.forEach(queue => {",
                  "        console.log(`\\nüéØ ${queue.name}: ${queue.totalWaiting} aguardando, atual: ${queue.currentNumber}`);",
                  "    });",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üéüÔ∏è 5. Cliente - Tirar Senhas",
      "item": [
        {
          "name": "Cliente entra na Fila (Endocrinologia)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientName\": \"Maria Silva\",\n  \"clientPhone\": \"(11) 99999-1111\",\n  \"clientEmail\": \"maria.silva@email.com\",\n  \"priority\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/queues/{{queueId}}/tickets",
              "host": ["{{baseUrl}}"],
              "path": ["queues", "{{queueId}}", "tickets"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const ticket = pm.response.json();",
                  "    pm.collectionVariables.set('ticketId', ticket.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Cliente 2 entra na Fila",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientName\": \"Jo√£o Santos\",\n  \"clientPhone\": \"(11) 99999-2222\",\n  \"priority\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/queues/{{queueId}}/tickets",
              "host": ["{{baseUrl}}"],
              "path": ["queues", "{{queueId}}", "tickets"]
            }
          }
        },
        {
          "name": "Cliente 3 entra na Fila",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientName\": \"Ana Costa\",\n  \"clientPhone\": \"(11) 99999-3333\",\n  \"priority\": 2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/queues/{{queueId}}/tickets",
              "host": ["{{baseUrl}}"],
              "path": ["queues", "{{queueId}}", "tickets"]
            }
          }
        }
      ]
    },
    {
      "name": "üëÅÔ∏è 6. Cliente - Consultar Status",
      "item": [
        {
          "name": "Verificar Status do Ticket",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tickets/{{ticketId}}",
              "host": ["{{baseUrl}}"],
              "path": ["tickets", "{{ticketId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "üìû 7. Atendente - Gerenciar Fila",
      "item": [
        {
          "name": "Chamar Pr√≥ximo da Fila",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues/{{queueId}}/call-next",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues", "{{queueId}}", "call-next"]
            }
          }
        },
        {
          "name": "Rechamar Ticket",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tickets/{{ticketId}}/recall",
              "host": ["{{baseUrl}}"],
              "path": ["tickets", "{{ticketId}}", "recall"]
            }
          }
        },
        {
          "name": "Pular Ticket",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tickets/{{ticketId}}/skip",
              "host": ["{{baseUrl}}"],
              "path": ["tickets", "{{ticketId}}", "skip"]
            }
          }
        },
        {
          "name": "Completar Atendimento",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tickets/{{ticketId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": ["tickets", "{{ticketId}}", "complete"]
            }
          }
        }
      ]
    },
    {
      "name": "üîß 8. Testes de Seguran√ßa",
      "item": [
        {
          "name": "Teste Rate Limiting",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Executar m√∫ltiplas vezes para testar rate limiting",
                  "pm.test('Rate limiting funcionando', function () {",
                  "    pm.expect([200, 429]).to.include(pm.response.code);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Teste JWT Inv√°lido",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer token_invalido"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('JWT inv√°lido rejeitado', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Teste Cross-Tenant Access",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{authToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tenants/fake-tenant-id/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "fake-tenant-id", "queues"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Cross-tenant access bloqueado', function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üìä 9. Cen√°rio Completo",
      "item": [
        {
          "name": "üè• Fluxo Centro Cl√≠nico Completo",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Este √© um teste de fluxo completo",
                  "// Execute os requests em ordem para simular o cen√°rio real"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/tenants/{{tenantId}}/queues",
              "host": ["{{baseUrl}}"],
              "path": ["tenants", "{{tenantId}}", "queues"]
            }
          }
        }
      ]
    },
    {
      "name": "üì± 8. Cliente - APP Multi-Filas",
      "item": [
        {
          "name": "üîç Buscar TODAS as Senhas do Cliente",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients/my-tickets?phone={{clientPhone}}",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "my-tickets"],
              "query": [
                {
                  "key": "phone",
                  "value": "{{clientPhone}}"
                },
                {
                  "key": "email",
                  "value": "{{clientEmail}}",
                  "disabled": true
                }
              ]
            }
          }
        },
        {
          "name": "üìä Dashboard Consolidado do Cliente",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients/dashboard?phone={{clientPhone}}",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "dashboard"],
              "query": [
                {
                  "key": "phone",
                  "value": "{{clientPhone}}"
                }
              ]
            }
          }
        },
        {
          "name": "‚ö° M√©tricas de Velocidade em Tempo Real",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/clients/queue-metrics?queueId={{queueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "queue-metrics"],
              "query": [
                {
                  "key": "queueId",
                  "value": "{{queueId}}"
                }
              ]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api/v1"
    },
    {
      "key": "authToken",
      "value": ""
    },
    {
      "key": "tenantId",
      "value": ""
    },
    {
      "key": "queueId",
      "value": ""
    },
    {
      "key": "ticketId",
      "value": ""
    },
    {
      "key": "clientPhone",
      "value": "(11) 99999-1111"
    },
    {
      "key": "clientEmail",
      "value": "cliente@test.com"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Setup global para todos os requests",
          "console.log('üé´ Fila Digital API - Request iniciado');"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Verifica√ß√µes globais",
          "pm.test('Response time aceit√°vel', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "if (pm.response.code >= 400) {",
          "    console.log('‚ùå Erro:', pm.response.status, pm.response.json());",
          "} else {",
          "    console.log('‚úÖ Sucesso:', pm.response.status);",
          "}"
        ]
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Scripts globais aqui se necess√°rio"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Verifica√ß√µes globais",
          "pm.test('Response time aceit√°vel', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "if (pm.response.code >= 400) {",
          "    console.log('‚ùå Erro:', pm.response.status, pm.response.json());",
          "} else {",
          "    console.log('‚úÖ Sucesso:', pm.response.status);",
          "}"
        ]
      }
    }
  ]
}
